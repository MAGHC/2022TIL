https://www.youtube.com/watch?v=TZz9VHjJzMk

### 브라우저렌더링 과정

크리티컬 렌더링 패스
parse - > 레이아웃 -> 페인트 -> 컴포지트

### reflow를 방지하는 방법?

보통 translate X Y

하지만 translate 3d x y z 를 활용하면 더 빠름

why?

브라우저의 composite 를 알아야됨

페인트 레이어 그래픽 레이어 두가지가있는데

### 그래픽 레이어의특징

gpu를 활용하여 이미지로 변환

병렬 처리에 특화되어 더 빠르게 변환

기존레이어에서 새롭게 분리 주변 레이어에 영향 없이 해당 레이어만 빠르게 그리고, 출력 가능

gpu에서 작업이이루어져 cpu와 그래픽작업이 분리되어 저사양 기기에서 cpu의 부담을 덜어준다

그래픽 레이어는 이미지가 변경되지않는다면 합성과정에서 위치만 조정한다

### 페인트 레이어에서 그래픽 레이어로 분리되는 조건

transform 3d 관련 값을 사용한 경우

video 태그 3d 혹은 하드웨어 가속된 2d canvas 태그

animaition또는 transition 이 적용되어있고

opacity , transform ,filter 속성이 적용되어있을때

backdrop-filter

will - change

플래시와 같은 하드웨어 가속 플러그인

### 모두 gpu 쓰면 ㄴ?

-> 레이어 정보를 메모리에도 저장하게되어 추가적 메모리 점유 발생

-> cpu 에서 gpu 전달과정에서 지연시간 발생

-> 일부연산의 경우 cpu에서 더 빠른 케이스가 존재

### 간단하게 보는 composite 단계 정리

transform 의 3d 요소같이 일부 css 속성과 태그는 그래픽 레이어로분리
분리되었을땐 별도로 렌더링진행

페인트레이어는 cpu의 레스터 쓰레드 에서 레이어를 이미지로 변환하며

그래픽 레이어에서는 gpu에서 레이어를 이미지로 변환

레이어가 레스터화 될때마다

컴포지트 스레드는 gpu를 활용하여 쌓임 맥락을 통해 결정된 순서 에따라 이미지를 합성하여 화면에 출력

그래픽 레이어로 분리될시 대기중에도 비디오 메모리를 사용하게된다.

### css will- change

#a{
will-change: trasnform;
}

브라우저는 트랜스폼이 변경되는 상황을 미리 준비한다.

변경되지 않을 요소까지 미리 적용하게 될 시 그래픽 레이어가 계쏙 유지되고 메모리를 점유하여 성능저하가 발생한다.

윌ㅊ체인지를쓰면 비디오메모리 가 나중에 해제되네

### 언제 뭘쓸까

#### 그래픽 레이어

gpu가 잘하는 일일때

레이어 분리를 통해 연산의 이점을 얻을 수 있을때

많은 요소의 이동이 발생되어 프레임 저하를 예측할 수 있을떄

반대로 저사양 기기에서 잘 작동되어야되거나 레이어크기가 너무 크거나 많이 생성된다면 고려해야된다.

#### will-change

즉각적인 변화가 예측될때 사용하며

짧은 순간에 너무 자주바뀐다면 쓰면안되고

확실하지않다면 안되고 한번에너무많이 적용하면안된다

---

윌체인지보단 애니메이션과 트랜지션을 우선시도해라

참고로 리플로우 -> 랜더트리를 재생성하는 과정
